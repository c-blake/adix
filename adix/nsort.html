<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="https://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>adix/nsort</title>

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- CSS -->
<link rel="stylesheet" type="text/css" href="../nimdoc.out.css?v=2.0.17">

<!-- JS -->
<script type="text/javascript" src="../dochack.js?v=2.0.17"></script>
</head>
<body>
  <div class="document" id="documentId">
    <div class="container">
      <h1 class="title">adix/nsort</h1>
      <div class="row">
  <div class="three columns">
    <div class="theme-select-wrapper">
      <label for="theme-select">Theme:&nbsp;</label>
      <select id="theme-select" onchange="setTheme(this.value)">
        <option value="auto">ðŸŒ— Match OS</option>
        <option value="dark">ðŸŒ‘ Dark</option>
        <option value="light">ðŸŒ• Light</option>
      </select>
    </div>
    <div id="global-links">
      <ul class="simple">
        <li><a id="indexLink" href="../theindex.html">Index</a></li>
      </ul>
    </div>
    <div id="searchInputDiv">
      Search: <input type="search" id="searchInput" onkeyup="search()"/>
    </div>
    <div>
      Group by:
      <select onchange="groupBy(this.value)">
        <option value="section">Section</option>
        <option value="type">Type</option>
      </select>
    </div>
    <ul class="simple simple-toc" id="toc-list">
  <li>
  <a class="reference reference-toplevel" href="#6" id="56">Imports</a>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#7" id="57">Types</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#XForm" title="XForm = enum
  xfNone, xfRev, xfSgn, xfSgnRev, xfFlt, xfFltRev ## Transforms">XForm</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#8" id="58">Vars</a></summary>
    <ul class="simple simple-toc-section">
      <li><a class="reference" href="#verb" title="verb = 0">verb</a></li>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#12" id="62">Procs</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">nsort
  <li><a class="reference" href="#nsort%2Cpointer%2Cpointer%2Cint%2Cint%2Cuint8%2CXForm%2Cint" title="nsort(obs, tmp: pointer; n, sz: int; off: uint8; xf: XForm; b0 = 0): pointer">nsort(obs, tmp: pointer; n, sz: int; off: uint8; xf: XForm; b0 = 0): pointer</a></li>
<li><a class="reference" href="#nsort%2CopenArray%5BO%5D%2CW%2Cint" title="nsort[O, W](obs: var openArray[O]; off: W; xf = xfNone; b0 = 0)">nsort[O, W](obs: var openArray[O]; off: W; xf = xfNone; b0 = 0)</a></li>
<li><a class="reference" href="#nsort%2Cpointer%2Cpointer%2Cint%2Cint%2CW%2CXForm%2Cint" title="nsort[W: Ui248](obs, tmp: pointer; n, sz: int; off: W; xf: XForm; b0 = 0): pointer">nsort[W: Ui248](obs, tmp: pointer; n, sz: int; off: W; xf: XForm; b0 = 0): pointer</a></li>

</ul>

    </ul>
  </details>
</li>
<li>
  <details open>
    <summary><a class="reference reference-toplevel" href="#18" id="68">Templates</a></summary>
    <ul class="simple simple-toc-section">
      <ul class="simple nested-toc-section">nsortBy
  <li><a class="reference" href="#nsortBy.t%2Cuntyped%2Cuntyped%2Cint" title="nsortBy(x, field: untyped; b0 = 0): untyped">nsortBy(x, field: untyped; b0 = 0): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">nsortByRaw
  <li><a class="reference" href="#nsortByRaw.t%2Cuntyped%2Cuntyped%2Cint" title="nsortByRaw(x, field: untyped; b0 = 0): untyped">nsortByRaw(x, field: untyped; b0 = 0): untyped</a></li>

</ul>
<ul class="simple nested-toc-section">nsortByTag
  <li><a class="reference" href="#nsortByTag.t%2Cuntyped%2Cuntyped%2Cint" title="nsortByTag(x, field: untyped; b0 = 0): untyped">nsortByTag(x, field: untyped; b0 = 0): untyped</a></li>

</ul>

    </ul>
  </details>
</li>

</ul>

  </div>
  <div class="nine columns" id="content">
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L1" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L1" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

    <div id="tocRoot"></div>
    
    <p class="module-desc"><p>This numeric sort module encapsulates sorting by native numeric keys embedded at some offset inside Nim objects of any size (well, &lt;= 256 bytes for char- keyed obs, but you should &quot;tag sort&quot; objects &gt; 64B anyway).  This kind of interface allows low overhead generality and enables algorithms specialized to number types.  Such algorithms are often many times faster than comparison sorts.  The algo is roughly counting sort for 1-Byte keys and for [248]Byte native type keys an LSD radix sort with optional transforms from signed|float domains.  This implementation has several sadly rare optimizations.</p>
<p>FIRST, total order and order by digit0 is checked in the first histogramming pass to decide if remaining work can be skipped.  Hence, if run on an already sorted array, only one read-only pass over the data is done to confirm order. Similarly, items already sorted by digit0 induce no re-ordering write phase. Reverse order is also detected.  These non-branching integer comparisons add little work and potentially save a lot.</p>
<p>SECOND, only 2 counter buffers are ever needed at once - current pass write pointers &amp; next pass read histogram.  Using more wastes limited L1/L2 space and/or shrinks max histogram size (increasing number of passes).  The buffers for these two &quot;alternate&quot; histograms just toggle across passes.  (A several- histogram-at-once counting pass can also achieve no excess re-fetches, but at higher cache usage.  Cache use is same for 2B keys, but only high whole byte constancy can yield skipped 2nd passes.  The best 2B method depends on keys.)</p>
<p>THIRD, histogram details are optimized.  For moderate <tt class="docutils literal"><span class="pre"><span class="Identifier">n</span></span></tt>, prefix summing histograms into cumulative distribution functions (really output bin offsets) is a dominant cost.  So, this impl does SIMD parallel prefix sum.  This optim is more effective as more counters fit into vector registers.  So, this impl uses the smallest [1248]Byte counter needed for <tt class="docutils literal"><span class="pre"><span class="Identifier">n</span></span></tt> items &amp; takes care to align the 2 power of 2-sized counter buffers to maximize vector use.  Last, a time cost estimate formula &amp; Newton's method is used to decide pass sizes.</p>
<p>FOURTH, bits that vary across keys are measured (<tt class="docutils literal"><span class="pre"><span class="Identifier">mask</span> <span class="Keyword">or</span><span class="Operator">=</span><span class="Punctuation">(</span><span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Operator">-</span><span class="DecNumber">1</span><span class="Punctuation">]</span> <span class="Keyword">xor</span> <span class="Identifier">x</span><span class="Punctuation">[</span><span class="Identifier">i</span><span class="Punctuation">]</span><span class="Punctuation">)</span></span></tt>) in the first read-pass.  Key-wise constant bits are zero in said mask.  Since an array MUST be sorted by constant key bits, smart digit plans can skip them to maybe shrink pass count.  <tt class="docutils literal"><span class="pre"><span class="Identifier">pext32</span><span class="Operator">/</span><span class="Identifier">pext64</span></span></tt> from Intel's Advanced Bit Manipulation subset (Haswell 2014) are a cheap way to use the above mask. This optimization does not help bitwise non-constant data (other than ease of digit formation afforded by <tt class="docutils literal"><span class="pre"><span class="Identifier">pext</span></span></tt>).  However, this impl is structured so there is almost no added cost to access the potentially large savings.  Work on digit plans is ongoing.  This optimization is novel to my knowledge.  It seems small for an academic paper (maybe optimal digit plans would add enough to discuss) but likely to have been mentioned offhand already.  I'd cite a reference if I could and please cite me if you don't have one.  How well this does depends strongly upon bit-entropy of keys.  Eg., time(2) outputs, over allocated 8B ints, 64-bit VM addrs &amp; positive floats spanning 1..2 octaves may be constant above 12-24 LSbits.  Some samples may even get sorted in just one pass!  I'd bet much real-world f32 data is 2pass w/b0=12.</p>
<p>One undone optimization is multi-threads for counting phases.  This can boost L3-&gt;L1 read throughput by 2-9x (but since scattered writes are much slower than streaming reads, overall speed-up is likely limited).  Another maybe useful optimization is saving transformed keys in the tmp arrays (but this also needs inverse transforms on the final pass &amp; current xforms are already cheap compared to L2 or worse bandwidth costs.  So, 5-20% boost, I'd guess.)</p>
</p>
    <div class="section" id="6">
  <h1><a class="toc-backref" href="#6">Imports</a></h1>
  <dl class="item">
    <a class="reference external" href="cpuCT.html">cpuCT</a>, <a class="reference external" href="cumsum.html">cumsum</a>
  </dl>
</div>
<div class="section" id="7">
  <h1><a class="toc-backref" href="#7">Types</a></h1>
  <dl class="item">
    <div id="XForm">
  <dt><pre><a href="nsort.html#XForm"><span class="Identifier">XForm</span></a> <span class="Other">=</span> <span class="Keyword">enum</span>
  <span class="Identifier">xfNone</span><span class="Other">,</span> <span class="Identifier">xfRev</span><span class="Other">,</span> <span class="Identifier">xfSgn</span><span class="Other">,</span> <span class="Identifier">xfSgnRev</span><span class="Other">,</span> <span class="Identifier">xfFlt</span><span class="Other">,</span> <span class="Identifier">xfFltRev</span> <span class="Comment">## Transforms</span></pre></dt>
  <dd>
    
    
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L86" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L86" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

  </dl>
</div>
<div class="section" id="8">
  <h1><a class="toc-backref" href="#8">Vars</a></h1>
  <dl class="item">
    <div id="verb">
  <dt><pre><a href="nsort.html#verb"><span class="Identifier">verb</span></a> <span class="Other">=</span> <span class="DecNumber">0</span></pre></dt>
  <dd>
    
    verbosity level
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L89" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L89" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

  </dl>
</div>
<div class="section" id="12">
  <h1><a class="toc-backref" href="#12">Procs</a></h1>
  <dl class="item">
    <div id="nsort-procs-all">
  <div id="nsort,pointer,pointer,int,int,uint8,XForm,int">
  <dt><pre><span class="Keyword">proc</span> <a href="#nsort%2Cpointer%2Cpointer%2Cint%2Cint%2Cuint8%2CXForm%2Cint"><span class="Identifier">nsort</span></a><span class="Other">(</span><span class="Identifier">obs</span><span class="Other">,</span> <span class="Identifier">tmp</span><span class="Other">:</span> <span class="Identifier">pointer</span><span class="Other">;</span> <span class="Identifier">n</span><span class="Other">,</span> <span class="Identifier">sz</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">off</span><span class="Other">:</span> <span class="Identifier">uint8</span><span class="Other">;</span> <span class="Identifier">xf</span><span class="Other">:</span> <a href="nsort.html#XForm"><span class="Identifier">XForm</span></a><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">pointer</span> {.
    <span><span class="Other pragmadots">...</span></span><span class="pragmawrap"><span class="Identifier">raises</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">tags</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span><span class="Other">,</span> <span class="Identifier">forbids</span><span class="Other">:</span> <span class="Other">[</span><span class="Other">]</span></span>.}</pre></dt>
  <dd>
    
    Specialization of power-user interface for uint8-width keys.
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L359" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L359" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>
<div id="nsort,openArray[O],W,int">
  <dt><pre><span class="Keyword">proc</span> <a href="#nsort%2CopenArray%5BO%5D%2CW%2Cint"><span class="Identifier">nsort</span></a><span class="Other">[</span><span class="Identifier">O</span><span class="Other">,</span> <span class="Identifier">W</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">obs</span><span class="Other">:</span> <span class="Keyword">var</span> <span class="Identifier">openArray</span><span class="Other">[</span><span class="Identifier">O</span><span class="Other">]</span><span class="Other">;</span> <span class="Identifier">off</span><span class="Other">:</span> <span class="Identifier">W</span><span class="Other">;</span> <span class="Identifier">xf</span> <span class="Other">=</span> <span class="Identifier">xfNone</span><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span></pre></dt>
  <dd>
    
    Radix sort <tt class="docutils literal"><span class="pre"><span class="Identifier">obs</span></span></tt> by <tt class="docutils literal"><span class="pre"><span class="Identifier">W</span></span></tt>-width key at in-object offset <tt class="docutils literal"><span class="pre"><span class="Identifier">off</span></span></tt>, transforming keys according to <tt class="docutils literal"><span class="pre"><span class="Identifier">xf</span></span></tt>.  <tt class="docutils literal"><span class="pre"><span class="Identifier">b0</span></span></tt> is the number of bits for the first pass histogram.  0 means use a good default.  Uses temporary space equal to the size of <tt class="docutils literal"><span class="pre"><span class="Identifier">obs</span></span></tt>.  Does tiled merge sort for big data.
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L426" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L426" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>
<div id="nsort,pointer,pointer,int,int,W,XForm,int">
  <dt><pre><span class="Keyword">proc</span> <a href="#nsort%2Cpointer%2Cpointer%2Cint%2Cint%2CW%2CXForm%2Cint"><span class="Identifier">nsort</span></a><span class="Other">[</span><span class="Identifier">W</span><span class="Other">:</span> <span class="Identifier">Ui248</span><span class="Other">]</span><span class="Other">(</span><span class="Identifier">obs</span><span class="Other">,</span> <span class="Identifier">tmp</span><span class="Other">:</span> <span class="Identifier">pointer</span><span class="Other">;</span> <span class="Identifier">n</span><span class="Other">,</span> <span class="Identifier">sz</span><span class="Other">:</span> <span class="Identifier">int</span><span class="Other">;</span> <span class="Identifier">off</span><span class="Other">:</span> <span class="Identifier">W</span><span class="Other">;</span> <span class="Identifier">xf</span><span class="Other">:</span> <a href="nsort.html#XForm"><span class="Identifier">XForm</span></a><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">pointer</span></pre></dt>
  <dd>
    
    A power-user interface that allows skipping a final copy back to <tt class="docutils literal"><span class="pre"><span class="Identifier">obs</span></span></tt>. It uses <tt class="docutils literal"><span class="pre"><span class="Identifier">n</span></span></tt> to decide what sort algo to use.  Returns -1 if reversed.
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L367" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L367" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>

  </dl>
</div>
<div class="section" id="18">
  <h1><a class="toc-backref" href="#18">Templates</a></h1>
  <dl class="item">
    <div id="nsortBy-templates-all">
  <div id="nsortBy.t,untyped,untyped,int">
  <dt><pre><span class="Keyword">template</span> <a href="#nsortBy.t%2Cuntyped%2Cuntyped%2Cint"><span class="Identifier">nsortBy</span></a><span class="Other">(</span><span class="Identifier">x</span><span class="Other">,</span> <span class="Identifier">field</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    <p>Convenience template around <tt class="docutils literal"><span class="pre"><span class="Identifier">nsort</span></span></tt> proc to reduce typing.  <tt class="docutils literal"><span class="pre"><span class="Identifier">b0</span></span></tt> is the number of bits for the first pass histogram.  0 means use a good default.</p>
<p>You can only nsort by one numeric field at a time, but sorts are stable. Do <tt class="docutils literal"><span class="pre"><span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">nsortBy</span> <span class="Identifier">foo</span><span class="Punctuation">;</span> <span class="Identifier">x</span><span class="Operator">.</span><span class="Identifier">nsortBy</span> <span class="Identifier">bar</span></span></tt> to do a multi-level sort.</p>
<pre class="listing"><span class="Keyword">import</span> <span class="Identifier">nsort</span>
<span class="Keyword">var</span> <span class="Identifier">recs</span> <span class="Operator">=</span> <span class="Operator">@</span><span class="Punctuation">[</span><span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">:</span> <span class="FloatNumber">3.0</span><span class="Punctuation">,</span> <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="DecNumber">50</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">:</span> <span class="FloatNumber">6.0</span><span class="Punctuation">,</span> <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="DecNumber">30</span><span class="Punctuation">)</span><span class="Punctuation">,</span> <span class="Punctuation">(</span><span class="Identifier">f</span><span class="Punctuation">:</span> <span class="FloatNumber">5.0</span><span class="Punctuation">,</span> <span class="Identifier">age</span><span class="Punctuation">:</span> <span class="DecNumber">30</span><span class="Punctuation">)</span><span class="Punctuation">]</span>
<span class="Identifier">recs</span><span class="Operator">.</span><span class="Identifier">nsortBy</span> <span class="Identifier">f</span>         <span class="Comment"># Multi-level sort by `age` then `f`.  Invoke</span>
<span class="Identifier">recs</span><span class="Operator">.</span><span class="Identifier">nsortBy</span> <span class="Identifier">age</span>       <span class="Comment"># ..in REVERSE order of usual comparison-order.</span>
<span class="Keyword">for</span> <span class="Identifier">r</span> <span class="Keyword">in</span> <span class="Identifier">recs</span><span class="Punctuation">:</span> <span class="Identifier">echo</span> <span class="Identifier">r</span>  <span class="Comment"># Right output: @[(5.0,30), (6.0,30), (3.0,50)]</span></pre>
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L458" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L458" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="nsortByRaw-templates-all">
  <div id="nsortByRaw.t,untyped,untyped,int">
  <dt><pre><span class="Keyword">template</span> <a href="#nsortByRaw.t%2Cuntyped%2Cuntyped%2Cint"><span class="Identifier">nsortByRaw</span></a><span class="Other">(</span><span class="Identifier">x</span><span class="Other">,</span> <span class="Identifier">field</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    Used by <tt class="docutils literal"><span class="pre"><span class="Identifier">nsortBy</span></span></tt> for small objects (or directly by users who know what they are doing).
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L434" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L434" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>
<div id="nsortByTag-templates-all">
  <div id="nsortByTag.t,untyped,untyped,int">
  <dt><pre><span class="Keyword">template</span> <a href="#nsortByTag.t%2Cuntyped%2Cuntyped%2Cint"><span class="Identifier">nsortByTag</span></a><span class="Other">(</span><span class="Identifier">x</span><span class="Other">,</span> <span class="Identifier">field</span><span class="Other">:</span> <span class="Identifier">untyped</span><span class="Other">;</span> <span class="Identifier">b0</span> <span class="Other">=</span> <span class="DecNumber">0</span><span class="Other">)</span><span class="Other">:</span> <span class="Identifier">untyped</span></pre></dt>
  <dd>
    
    So-called tag sort used by <tt class="docutils literal"><span class="pre"><span class="Identifier">nsortBy</span></span></tt> for large objects (or directly by users who know what they are doing).
    <a href="https://github.com/c-blake/adix/tree/f5c4e63dae283b3dd5ea358c8fe920876a0cff14/adix/nsort.nim#L448" class="link-seesrc" target="_blank">Source</a>&nbsp;&nbsp;
<a href="https://github.com/c-blake/adix/edit/master/adix/nsort.nim#L448" class="link-seesrc" target="_blank" >Edit</a>&nbsp;&nbsp;

  </dd>
</div>

</div>

  </dl>
</div>

  </div>
</div>

      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br>
        <small style="color: var(--hint);">Made with Nim. Generated: 2025-10-17 12:12:25 UTC</small>
      </div>
    </div>
  </div>
  
  <!-- Google fonts -->
  <link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>
</body>
</html>
